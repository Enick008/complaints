<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Prompt', sans-serif; }
    header img { height: 100px; width: auto; margin: 0 auto; }
    footer { background-color: #fee2e2; color: #991b1b; text-align: center; padding: 1rem; font-size: 0.875rem; }
  </style>
</head>
<body class="bg-red-50">
  <header class="bg-white shadow-md py-4 flex justify-center">
    <img src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Seal_of_Ko_Samui.png" alt="Ko Samui Seal" />
  </header>

  <main class="max-w-4xl mx-auto bg-white rounded-xl shadow-md mt-6 p-6">
    <div class="mb-6">
      <button onclick="showTab('form')" class="px-4 py-2 bg-red-600 text-white rounded">‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
      <button onclick="showTab('stats')" class="px-4 py-2 bg-red-600 text-white rounded">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
    </div>

    <div id="formTab">
      <h1 class="text-xl font-bold text-red-700 mb-4">üìã ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
      <form id="complaintForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input type="hidden" id="complaintId" />
        <div><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label><input type="date" id="dateReceived" class="w-full border rounded p-2" /></div>
        <div><label>‡πÄ‡∏•‡∏Ç‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label><input type="text" id="registerNo" class="w-full border rounded p-2" /></div>
        <div><label>‡∏ä‡∏∑‡πà‡∏≠</label><input type="text" id="name" class="w-full border rounded p-2" /></div>
        <div><label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label><input type="text" id="address" class="w-full border rounded p-2" /></div>
        <div>
          <label>‡∏ï‡∏≥‡∏ö‡∏•</label>
          <select id="subdistrict" class="w-full border rounded p-2">
            <option>‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥</option><option>‡∏ö‡πà‡∏≠‡∏ú‡∏∏‡∏î</option><option>‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏ï</option>
            <option>‡∏•‡∏¥‡∏õ‡∏∞‡∏ô‡πâ‡∏≠‡∏¢</option><option>‡∏ï‡∏•‡∏¥‡πà‡∏á‡∏á‡∏≤‡∏°</option><option>‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏∑‡∏≠‡∏á</option><option>‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á</option>
          </select>
        </div>
        <div><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input type="text" id="phone" class="w-full border rounded p-2" /></div>
        <div>
          <label>‡∏ù‡πà‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</label>
          <select id="department" class="w-full border rounded p-2">
            <option>‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
            <option>‡∏ù‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ô‡πâ‡∏≥</option>
            <option>‡∏ù‡πà‡∏≤‡∏¢‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß</option>
          </select>
        </div>
        <div>
          <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
          <select id="status" class="w-full border rounded p-2">
            <option>‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
            <option>‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß</option>
          </select>
        </div>
        <div><label>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</label><input type="text" id="responsiblePerson" class="w-full border rounded p-2" /></div>
        <div class="md:col-span-2">
          <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
          <textarea id="details" rows="3" class="w-full border rounded p-2"></textarea>
        </div>
        <div class="md:col-span-2" id="completeSection" style="display:none">
          <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à</label>
          <input type="date" id="completeDate" class="w-full border rounded p-2" />
          <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</label>
          <textarea id="completeDetails" rows="2" class="w-full border rounded p-2"></textarea>
        </div>
        <div class="md:col-span-2 text-right">
          <button type="button" onclick="submitComplaint()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
      </form>
    </div>

    <div id="statsTab" style="display:none">
      <h2 class="text-xl font-bold text-red-700 mb-4">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
      <canvas id="statusChart" class="mb-6"></canvas>
      <canvas id="deptChart"></canvas>
    </div>
  </main>

  <footer>
    ¬©2025 ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏Å‡∏≠‡∏á‡∏ä‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏Ç‡∏≤‡∏†‡∏¥‡∏ö‡∏≤‡∏• ‡πÇ‡∏î‡∏¢ ‡∏ô‡∏≤‡∏¢‡∏ò‡∏µ‡∏£‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏û‡∏π‡∏•‡πÄ‡∏Ç‡∏≤‡∏•‡πâ‡∏≤‡∏ô
  </footer>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbw4LM0Ig-Pr1VhiheafQfX3hu8rzwWZhPUXa1n17oO7rq6OQJ6WTjcoOsyrCVLdRww/exec';

    function showTab(tab) {
      document.getElementById('formTab').style.display = tab === 'form' ? 'block' : 'none';
      document.getElementById('statsTab').style.display = tab === 'stats' ? 'block' : 'none';
      if (tab === 'stats') fetchStatistics();
    }

    function submitComplaint() {
      Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', didOpen: () => Swal.showLoading(), allowOutsideClick: false });
      const data = {
        dateReceived: document.getElementById('dateReceived').value,
        registerNo: document.getElementById('registerNo').value,
        name: document.getElementById('name').value,
        address: document.getElementById('address').value,
        subdistrict: document.getElementById('subdistrict').value,
        phone: document.getElementById('phone').value,
        department: document.getElementById('department').value,
        status: document.getElementById('status').value,
        responsiblePerson: document.getElementById('responsiblePerson').value,
        details: document.getElementById('details').value,
        completeDate: document.getElementById('completeDate').value,
        completeDetails: document.getElementById('completeDetails').value,
        action: 'addComplaint'
      };
      fetch(API_URL, { method: 'POST', body: JSON.stringify(data), headers: { 'Content-Type': 'application/json' } })
        .then(res => res.json())
        .then(result => {
          if (result.success) {
            Swal.fire({ icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!' });
            document.getElementById('complaintForm').reset();
          } else throw new Error(result.message);
        })
        .catch(err => Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: err.message }));
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('dateReceived').valueAsDate = new Date();
      document.getElementById('status').addEventListener('change', (e) => {
        document.getElementById('completeSection').style.display = e.target.value === '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß' ? 'block' : 'none';
      });
    });

    function fetchStatistics() {
      fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'getStatistics' }),
        headers: { 'Content-Type': 'application/json' }
      })
        .then(res => res.json())
        .then(result => {
          if (!result.success) throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
          renderCharts(result.stats);
        })
        .catch(err => Swal.fire({ icon: 'error', title: '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', text: err.message }));
    }

    function renderCharts(stats) {
      const statusCtx = document.getElementById('statusChart').getContext('2d');
      new Chart(statusCtx, {
        type: 'bar',
        data: {
          labels: Object.keys(stats.byStatus),
          datasets: [{
            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',
            data: Object.values(stats.byStatus),
          }]
        }
      });

      const deptCtx = document.getElementById('deptChart').getContext('2d');
      new Chart(deptCtx, {
        type: 'pie',
        data: {
          labels: Object.keys(stats.byDepartment),
          datasets: [{
            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏ù‡πà‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö',
            data: Object.values(stats.byDepartment),
          }]
        }
      });
    }
  </script>
</body>
</html>
